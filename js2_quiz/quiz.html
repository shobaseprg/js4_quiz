<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>クイズ問題</title>
  </head>

  <body>
    <h1 id = "infomation">ようこそ</h1>
    <h3 id = "genre_display"></h3>
    <h3 id = "dificult_display"></h3>

    <hr width="100%">
      <p id = "quiz_display">以下のボタンをクリック</p>
    <hr width="100%">
    <button type="button" id = "start_btn">
      開始
    </button>
    <div id = "answer_btns">
    </div>
    <script>
      const create_answers = (randam_answers) => {// 答えを作る
        for(let i = 0; i < randam_answers.length; i++){
          let div = document.createElement("div");
          document.getElementById("answer_btns").appendChild(div);
          let button = document.createElement("BUTTON");
          button.textContent = randam_answers[i];
          div.appendChild(button);
        }
      };

      const shaffule_answers = (target_quiz) =>{// 正解と不正解をランダムに混ぜる関数
        var all_answers = target_quiz["incorrect_answers"].push(target_quiz["correct_answer"]);// 正解と不正解を同じ配列に

        for(let i = target_quiz["incorrect_answers"].length - 1; i > 0; i--){          // シャッフルする
          let j = Math.floor(Math.random() * (i + 1));
          let tmp = target_quiz["incorrect_answers"][i];
          target_quiz["incorrect_answers"][i] = target_quiz["incorrect_answers"][j];
          target_quiz["incorrect_answers"][j] = tmp;
        }
        // console.log(target_quiz["correct_answer"]);
        //   console.log(target_quiz["incorrect_answers"]);
        var randam_answers = target_quiz["incorrect_answers"]
        create_answers(randam_answers);// 答えを作る関数を呼び出す
      }
      const present_quiz = (quiz_array) => {
        let count = 0;
        let target_quiz = quiz_array[count];
        let quiz_number = count + 1;
        document.getElementById("infomation").innerText = "問題" + quiz_number;
        document.getElementById("genre_display").innerText = "[ジャンル]" + target_quiz["category"] ;
        document.getElementById("dificult_display").innerText = "[難易度]" + target_quiz["difficulty"] ;
        document.getElementById("quiz_display").innerText = quiz_array[count]["question"] ;

        shaffule_answers(target_quiz);

        // console.log(quiz_array[count]["correct_answer"]);
        // console.log(quiz_array[count]["incorrect_answers"]);
        // console.log(quiz_array);

      }
      document.getElementById("start_btn").addEventListener("click", () => { // 開始を押した場合
        document.getElementById("infomation").innerText = "取得中";
        document.getElementById("quiz_display").innerText = "少々お待ちください";

        const start_btn = document.getElementById("start_btn");  // 開始ボタンを削除
        start_btn.parentNode.removeChild(start_btn);

        fetch('https://opentdb.com/api.php?amount=10')
        .then((response) => {
        return response.json();
        })
        .then((json) => {
        let quiz_array = json.results;
        present_quiz(quiz_array)
        })
      });    
    </script>

  </body>
</html>